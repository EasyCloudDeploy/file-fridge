<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Files - File Fridge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-snow"></i> <span id="app-name-navbar">File Fridge</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/paths">
                            <i class="bi bi-folder"></i> Paths
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/files">
                            <i class="bi bi-file-earmark"></i> Files
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tags">
                            <i class="bi bi-tags"></i> Tags
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/notifiers">
                            <i class="bi bi-bell"></i> Notifiers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/stats">
                            <i class="bi bi-graph-up"></i> Statistics
                        </a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <span class="badge bg-light text-dark">
                        <i class="bi bi-thermometer-snow"></i> <span id="app-version">Loading...</span>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <main class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="bi bi-file-earmark"></i> File Browser
                </h1>
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-6 col-lg-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="search_input" placeholder="Search file paths...">
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="path_id_filter">Path:</label>
                    <select class="form-select" id="path_id_filter">
                        <option value="">All Paths</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="storage_filter">Storage:</label>
                    <select class="form-select" id="storage_filter">
                        <option value="">All</option>
                        <option value="hot">Hot</option>
                        <option value="cold">Cold</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="status_filter">Status:</label>
                    <select class="form-select" id="status_filter">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="moved">Moved</option>
                        <option value="deleted">Deleted</option>
                        <option value="missing">Missing</option>
                        <option value="migrating">Migrating</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="btn-group w-100">
                    <button class="btn btn-primary" type="button" id="search_btn">
                        Search
                    </button>
                    <button class="btn btn-outline-secondary" type="button" id="clear_filters_btn">
                        Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Advanced Filters -->
        <div class="row g-3 mb-3">
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="extension_filter">Ext:</label>
                    <input type="text" class="form-control" id="extension_filter" placeholder=".jpg">
                </div>
            </div>
            <div class="col-md-3 col-lg-3">
                <div class="input-group">
                    <label class="input-group-text" for="mime_filter">MIME:</label>
                    <input type="text" class="form-control" id="mime_filter" placeholder="image/*">
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="checksum_filter">Checksum:</label>
                    <select class="form-select" id="checksum_filter">
                        <option value="">All</option>
                        <option value="true">With Checksum</option>
                        <option value="false">Without Checksum</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <div class="input-group">
                    <label class="input-group-text" for="pinned_filter">Pinned:</label>
                    <select class="form-select" id="pinned_filter">
                        <option value="">All</option>
                        <option value="true">Pinned Only</option>
                        <option value="false">Not Pinned</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3 col-lg-3">
                <div class="input-group">
                    <label class="input-group-text" for="location_id_filter">Storage:</label>
                    <select class="form-select" id="location_id_filter">
                        <option value="">All Locations</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-6 col-lg-4">
                <div class="input-group">
                    <span class="input-group-text">Size:</span>
                    <input type="number" class="form-control" id="min_size_filter" placeholder="Min bytes">
                    <span class="input-group-text">to</span>
                    <input type="number" class="form-control" id="max_size_filter" placeholder="Max bytes">
                </div>
            </div>
            <div class="col-md-6 col-lg-6">
                <div class="input-group">
                    <span class="input-group-text">Modified:</span>
                    <input type="datetime-local" class="form-control" id="min_mtime_filter"
                        title="Min modification time">
                    <span class="input-group-text">to</span>
                    <input type="datetime-local" class="form-control" id="max_mtime_filter"
                        title="Max modification time">
                </div>
            </div>
        </div>

        <!-- Tag Filter -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="input-group">
                    <label class="input-group-text" for="tag_filter"><i class="bi bi-tags"></i> Tags:</label>
                    <select class="form-select" id="tag_filter" multiple size="1">
                        <option value="">All Tags</option>
                    </select>
                    <button class="btn btn-outline-secondary" type="button" id="clear_tag_filter_btn">
                        <i class="bi bi-x-circle"></i> Clear
                    </button>
                </div>
                <div class="form-text">Select one or more tags to filter files (hold Ctrl/Cmd to select multiple)</div>
            </div>
            <div class="col-md-6 text-end">
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="cleanupMissingFiles()"
                        title="Clean up records for files that no longer exist">
                        <i class="bi bi-trash"></i> Cleanup Missing
                    </button>
                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="cleanupDuplicates()"
                        title="Remove duplicate file records">
                        <i class="bi bi-files"></i> Remove Duplicates
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div id="files-loading" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading files...</span>
                            </div>
                            <p class="text-muted mt-3">Loading files...</p>
                        </div>
                        <div id="files-content" style="display: none;">
                            <div class="table-responsive">
                                <table class="table table-hover" id="filesTable">
                                    <thead>
                                        <tr>
                                            <th class="sortable" data-sort="file_path">
                                                File Path <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="storage_type">
                                                Storage Location <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="file_size">
                                                Size <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="file_mtime">
                                                Modified Time <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="file_atime">
                                                Access Time <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="file_ctime">
                                                Change Time <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="status">
                                                Status <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th class="sortable" data-sort="last_seen">
                                                Last Seen <i class="bi bi-arrow-down-up"></i>
                                            </th>
                                            <th>Tags</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Files will be loaded here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="no-files-message" class="text-center py-5" style="display: none;">
                            <i class="bi bi-file-earmark-x display-1 text-muted"></i>
                            <p class="text-muted mt-3">No files found.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination Controls -->
        <div class="row mt-3">
            <div class="col-12" id="pagination-controls">
                <!-- Pagination will be rendered here by JavaScript -->
            </div>
        </div>

        <!-- Thaw Modal -->
        <div class="modal fade" id="thawModal" tabindex="-1" aria-labelledby="thawModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="thawModalLabel">Move File to Hot Storage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Move this file from cold storage back to hot storage?</p>
                        <p><strong>File:</strong> <code id="thawFileName"></code></p>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="pin_file" id="pinTemp" value="false"
                                    checked>
                                <label class="form-check-label" for="pinTemp">
                                    <strong>Temporary</strong> - Move back, but file may be moved again on next scan if
                                    it matches criteria
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="pin_file" id="pinPermanent"
                                    value="true">
                                <label class="form-check-label" for="pinPermanent">
                                    <strong>Pinned</strong> - Move back and exclude from future scans
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-warning" id="confirmThawBtn">
                            <i class="bi bi-arrow-left-circle"></i> Move to Hot Storage
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Tags Modal -->
        <div class="modal fade" id="manageTagsModal" tabindex="-1" aria-labelledby="manageTagsModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="manageTagsModalLabel">Manage Tags</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>File:</strong> <code id="tagFileName"></code></p>

                        <div class="mb-3">
                            <label class="form-label">Current Tags</label>
                            <div id="currentTags" class="mb-2">
                                <span class="text-muted">Loading...</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="addTagSelect" class="form-label">Add Tag</label>
                            <div class="input-group">
                                <select class="form-select" id="addTagSelect">
                                    <option value="">Select a tag...</option>
                                </select>
                                <button class="btn btn-primary" type="button" id="addTagBtn" disabled>
                                    <i class="bi bi-plus-circle"></i> Add
                                </button>
                            </div>
                            <div class="form-text">Select a tag from the list to add it to this file</div>
                        </div>

                        <div id="tagError" class="alert alert-danger d-none" role="alert"></div>
                        <div id="tagSuccess" class="alert alert-success d-none" role="alert"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-5 py-3 bg-light text-center">
        <div class="container">
            <small class="text-muted"><span id="app-name-footer">File Fridge</span> v<span
                    id="footer-app-version">Loading...</span> - File Cold Storage Management</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/files.js"></script>
    <script>
        // Load app information on page load
        document.addEventListener('DOMContentLoaded', loadAppInfo);
    </script>
</body>

</html>